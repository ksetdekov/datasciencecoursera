---
title: "Which transmission type gets better MPG and by how much?"
author: "Kirill Setdekov"
date: "September 11, 2019"
output:
  pdf_document:
    keep_md: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	cache = TRUE,
	echo = TRUE
)
```

```{r load}
require(datasets)
require(ggplot2)
require(dplyr)
require(gridExtra)
data(mtcars)
head(mtcars)
```


```{r preparation}
# convert weight to metric t
mtcars <- mtcars %>% 
    mutate(wt = wt*0.45359237,
                            am = factor(am, levels = c(0,1), labels = c("AT","MT")),
                            cylsize = disp/cyl)
```

```{r expl}
# exploratory analysis
summary(mtcars$mpg)

p1 <-
ggplot(mtcars, aes(y = mpg, x = am, fill = am)) + geom_violin() +
labs(title = "Violin plot of MPG \nby stransmission type")+theme_bw()

p2 <-
ggplot(mtcars, aes(x = wt, y = mpg, color = am)) +
geom_point() + geom_smooth() +
labs(title = "MPG distribution by weight and \nstransmission type with trend lines")+
    theme_bw()

grid.arrange(p1, p2, nrow = 1)
```

“Is an automatic or manual transmission better for MPG?”
A manual transmission is better for 
```{r regressions}

mt <- lm(mpg~. -cylsize, data = mtcars)
summary(mt)
anova(mt)

mt2 <- lm(mpg~disp+cyl+wt+am+cylsize, data = mtcars)
summary(mt2)
anova(mt, mt2)

mt3 <- lm(mpg~disp+cyl+wt+cylsize+am, data = mtcars)
summary(mt3)
anova(mt3,mt2)
anova(mt3)
shapiro.test(mt3$residuals)

mt4 <- lm(mpg~disp+cyl+wt+cylsize, data = mtcars)
anova(mt3,mt4)

anova(mt3,mt)
anova(mt)



mtam <- lm(mpg~am, data = mtcars)
summary(mtam)


```

"Quantify the MPG difference between automatic and manual transmissions"
By itsetlf manual transmission yields`{r} mtam$coefficients[2]` higher MPG compared to an automatic transmission

Adjusted for all factors - manual transmissions in a car gives it `{r} mt$coefficients[9]` higher MPG compared to an automatic transmission.
However, this result is statistically insignificant and the best predictors of MPG are cylinder count, displacement, cylinder size and weight.
Adjusting for the factors in the best model, manual transmission provides `{r} mt3$coefficients[6]` lower MPG compared to an automatic transmission.

```{r compare}
mancoef <- c(mtam$coefficients[2],mt$coefficients[9],mt3$coefficients[6])
confmanlower <- c(confint(mtam)[2,1],confint(mt)[9,1],confint(mt3)[6,1])
confmanupper <- c(confint(mtam)[2,2],confint(mt)[9,2],confint(mt3)[6,2])
estimate <- c("Transmission only","Adjusted for all factors","Adjusted by best model")
coefdf <- data.frame(estimate,mancoef,confmanlower, confmanupper)
coefdf$estimate <- relevel(coefdf$estimate,"Transmission only")


p <- ggplot(coefdf, aes(x=estimate, y=mancoef, fill=estimate)) + 
  geom_bar(stat="identity", color="black") +
  geom_errorbar(aes(ymin=confmanlower, ymax=confmanupper), width=.3,
                 position=position_dodge(.9))
p+labs(title="Comparison of manual transmission impact on MPG", x="Model used", y = "Change in MPG for manual compared to AT")+
   theme_bw() 
```


Your report must be:

* Written as a PDF printout of a compiled (using knitr) R markdown document.
*Brief. Roughly the equivalent of 2 pages or less for the main text. Supporting figures in an appendix can be included up to 5 total pages including the 2 for the main report. The appendix can only include figures.
* Include a first paragraph executive summary.
* Upload your PDF by clicking the Upload button below the text box.

Did the student interpret the coefficients correctly?
Did the student do some exploratory data analyses?
Did the student fit multiple models and detail their strategy for model selection?
Did the student answer the questions of interest or detail why the question(s) is (are) not answerable?
Did the student do a residual plot and some diagnostics?
Did the student quantify the uncertainty in their conclusions and/or perform an inference correctly?
Was the report brief (about 2 pages long) for the main body of the report and no longer than 5 with supporting appendix of figures?